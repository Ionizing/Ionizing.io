<!doctype html>
<html lang="zh-cn">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>在 VASP(PBE) 计算中如何优雅地踩坑？ | 伪化生搬砖工地</title>
    <meta property="og:title" content="在 VASP(PBE) 计算中如何优雅地踩坑？ - 伪化生搬砖工地">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-03-28T17:28:20&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-03-28T17:28:20&#43;08:00'>
        
    <meta name="Keywords" content="Programming,C,Rust,VASP,FirstPrinciple">
    <meta name="description" content="在 VASP(PBE) 计算中如何优雅地踩坑？">
        
    <meta name="author" content="Ionizing">
    <meta property="og:url" content="https://ionizing.page/post/how-to-struggle-with-vasp/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://ionizing.page/">
                        伪化生搬砖工地
                    </a>
                
                <p class="description">Challenge Everything</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://ionizing.page/">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#vasp-的输入文件">VASP 的输入文件</a></li>
    <li><a href="#我们需要-vasp-的哪些输出文件目前为止">我们需要 VASP 的哪些输出文件？（目前为止）</a></li>
    <li><a href="#用-pbe-方法跑出能带图的总体步骤">用 PBE 方法跑出能带图的总体步骤</a></li>
  </ul>

  <ul>
    <li><a href="#获取参数">获取参数</a></li>
    <li><a href="#实现结构">实现结构</a></li>
    <li><a href="#测出必要的参数">测出必要的参数</a>
      <ul>
        <li><a href="#incar-template"><code>INCAR</code> Template</a></li>
        <li><a href="#测出-sigma">测出 <code>SIGMA</code></a></li>
        <li><a href="#测出-encut">测出 <code>ENCUT</code></a></li>
        <li><a href="#测出-kpts">测出 kpts</a></li>
        <li><a href="#测出-a">测出 <code>a</code></a></li>
      </ul>
    </li>
    <li><a href="#弛豫结构优化relaxation">弛豫（结构优化，relaxation）</a></li>
    <li><a href="#高精度的电子自洽计算scf">高精度的电子自洽计算（SCF）</a></li>
    <li><a href="#计算能带band">计算能带（band）</a></li>
    <li><a href="#计算态密度dos">计算态密度（DOS）</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if(leftPos<220){
                postToc.css({"width":leftPos-10,"margin-left":(0-leftPos)})
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">在 VASP(PBE) 计算中如何优雅地踩坑？</h1>
        </header>
        <date class="post-meta meta-date">
            2018年3月28日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='https://ionizing.page/categories/FirstPrinciple'>FirstPrinciple</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <blockquote>
<p><strong>警告</strong>：本渣刚学 <code>VASP</code> 不久，对 <code>VASP</code> 的算法、参数不甚了解，如果有大触偶遇此文，并发现有错误，请在评论区指出或邮箱联系本渣。</p>
</blockquote>
<h1 id="前言">前言</h1>
<p>本文是本渣从 3 月初以来刚接触 <code>VASP</code> 所学技能与遇到坑的总结，以纪念我为文献中一副图而逝去的最近一星期。何为 <code>VASP</code> 以及<code> VASP</code> 能做什么？本渣只是一个刚学的菜鸡，恕不能回答，请自行 Google 解决。</p>
<h2 id="vasp-的输入文件">VASP 的输入文件</h2>
<p>想要执行一次最简单的计算，<code>VASP</code> 需要至少4个文件，它们分别是：</p>
<ul>
<li><code>INCAR</code>：<code>VASP</code> 计算的<strong>核心</strong>文件，基本等同于本次计算的司令部。它包含了“<strong>算什么</strong>”、“<strong>怎么算</strong>”、和“<strong>输入、输出那些</strong>”这三个方面的内容，它的几项常用（PBE计算中）参数在后面我们会较为详细地了解到；</li>
<li><code>POSCAR</code>：决定元胞结构的文件。它包含了元胞的格子类型、格子大小、以和格子内所有原子的种类及坐标，在弛豫时，它还可以指定哪些原子可以在哪些方向上进行<a href="https://en.wikipedia.org/wiki/Relaxation_(physics)">弛豫</a>，在 <code>VASP</code> 中我们无需给出原子间的成键情况，仅给出原子的坐标即可；</li>
<li><code>KPOINTS</code>：描述 <code>VASP</code> 计算中对元胞格子的 mesh 精细度，或指定格子中哪些点的信息需要计算（？这里留个问号，本渣也不是很懂这里）；</li>
<li><code>POTCAR</code>：赝势库，按 <code>POSCAR</code> 中元素列出顺序给出了对应元素的赝势库。</li>
</ul>
<p><strong>以上四个文件全为文本文件</strong>。当然我们还可以命令 <code>VASP</code> 读取上一次的计算结果，比如 <code>WAVECAR</code> ，比如 <code>CHGCAR</code> ，用以更快地收敛或者执行某些特殊的计算。</p>
<h2 id="我们需要-vasp-的哪些输出文件目前为止">我们需要 VASP 的哪些输出文件？（目前为止）</h2>
<ul>
<li><code>OUTCAR</code>：<code>VASP</code> 的计算日志，里面包含了几乎所有我们需要的结果，明文存储，随计算过程实时更新；</li>
<li><del><code>WAVECAR</code>：<strong>二进制</strong>文件，经常很大，计算结束时会将内存中的波函数平面波系数写入该文件。（我对这个文件所了解的仅有这些；</del></li>
<li><code>OSZICAR</code>：<code>VASP</code> 计算过程中能量收敛日志，每个电子步结束时写入；</li>
<li><del><code>EIGENVAL</code>：<code>VASP</code> 计算出的能带信息保存在这个文件中，计算结束时被写入（可以使用 <code>Python</code> 等工具以它为输入绘制能带图，但本渣太菜，目前还没写这个小程序；</del></li>
<li><code>CONTCAR</code>：在<a href="https://en.wikipedia.org/wiki/Relaxation_(physics)">弛豫</a>中，这个文件包含了<code>VASP</code>每个离子步结束时系统优化得到的元胞原子的坐标，每个离子步结束时写入；如果希望从还未收敛的弛豫结果继续计算，应直接将这个文件复制并重命名为 <code>POSCAR</code> 继续计算即可；</li>
<li><del><code>CHG</code> &amp; <code>CHGCAR</code>：这个两个文件都包含了元胞中原子的位置信息，以及电荷密度信息，但 <code>CHG</code> 比 <code>CHGCAR</code> 小一些，因其不包含 <code>PAW one centre</code>；</del></li>
<li><code>vasprun.xml</code>：XML 格式存储的 <code>VASP</code> 计算过程日志。</li>
<li><code>PROCAR</code>：</li>
</ul>
<h2 id="用-pbe-方法跑出能带图的总体步骤">用 PBE 方法跑出能带图的总体步骤</h2>
<ol>
<li>阅读文献，列出文献所给参数（如果有的话），比如 <code>SIGMA</code> ，<code>ISMEAR</code> ，<code>ENCUT</code> ，晶格常数 $a$ 等等信息；</li>
<li>查阅资料，<strong>实现文献所给结构</strong>，关注文献的结构是否经过超胞，是否有真空层，是否考虑 vdW ；</li>
<li>按顺序测出适合该体系的 <code>SIGMA</code> 、<code>ENCUT</code> 、kpts 、<code>a</code> ；（如果文献中给出了这些参数可跳过这一步</li>
<li>对结构进行弛豫，优化出最稳定结构；</li>
<li>对体系进行高精度的电子自洽计算；</li>
<li>跑出能带图、DOS 图以及直接获得所需的能量值等。</li>
</ol>
<h1 id="正文开始">正文开始</h1>
<p>下面以单层 C3B 结构为例，走一遍上面的流程，看看有哪些坑。</p>
<h2 id="获取参数">获取参数</h2>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">a <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5.17</span>         <span style="color:#998;font-style:italic">! 晶格常数
</span><span style="color:#998;font-style:italic"></span>EDIFF <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.0E-6</span>    <span style="color:#998;font-style:italic">! 弛豫收敛条件
</span><span style="color:#998;font-style:italic"></span>EDIFFG <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.001</span>    <span style="color:#998;font-style:italic">! 
</span><span style="color:#998;font-style:italic"></span>
kpts: Monkhorst    <span style="color:#998;font-style:italic">! KPOINTS 取法
</span></code></pre></td></tr></table>
</div>
</div><p>文献给出单层 C3B 的结构为 $D_{6h}$ ，长这样（从上往下看：</p>
<p><img src="http://owucpthrj.bkt.clouddn.com/FpGVI905Z66B8ksQjiULb3cLahCV" alt=""></p>
<h2 id="实现结构">实现结构</h2>
<p>建立元胞的格子基矢（D6h 的晶型都可以这样建系，使用 Direct 模式，可以手写所有原子的坐标），并表示出各个原子的坐标</p>
<p><img src="http://owucpthrj.bkt.clouddn.com/FiQMZt8-XbO9iXes05rkDhfFjHls" alt=""></p>
<p>所以它对应的 <code>POSCAR</code> 应为：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">C3B graphene like structure, a <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">5.17</span>               <span style="color:#998;font-style:italic">! 注释
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#099">5.17</span>                                             <span style="color:#998;font-style:italic">! 晶格放大系数
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.8660254037</span>   <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.5000000000</span>     <span style="color:#099">0.0000000000</span>   <span style="color:#998;font-style:italic">! 下面三行为实空间中定义元胞的三个格矢 a1, a2, a3
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.8660254037</span>    <span style="color:#099">0.5000000000</span>        <span style="color:#099">0.0000000000</span>
    <span style="color:#099">0.0000000000</span>    <span style="color:#099">0.0000000000</span>     <span style="color:#099">4.0000000000</span>   <span style="color:#998;font-style:italic">! 真空层厚度为 4.0*5.17 = 20.68A
</span><span style="color:#998;font-style:italic"></span>   B    C                                           <span style="color:#998;font-style:italic">! 元素种类，这一行是给人看的，而不是给VASP看的
</span><span style="color:#998;font-style:italic"></span>   <span style="color:#099">2</span>    <span style="color:#099">6</span>                                           <span style="color:#998;font-style:italic">! 对应元素的原子数目
</span><span style="color:#998;font-style:italic"></span>Direct                                              <span style="color:#998;font-style:italic">! 以定义的格矢为基底
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.0000000000</span>    <span style="color:#099">0.0000000000</span>    <span style="color:#099">0.0000000000</span>    <span style="color:#998;font-style:italic">! B 下面皆为原子坐标，顺序与第六行指定的元素种类相同
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.6666666666</span>    <span style="color:#099">0.6666666666</span>    <span style="color:#099">0.0000000000</span>    <span style="color:#998;font-style:italic">! 要注意，仅靠POSCAR，并vasp不知道元素的具体种类，而只知道元素种类的个数。
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.5000000000</span>    <span style="color:#099">0.0000000000</span>    <span style="color:#099">0.0000000000</span>    <span style="color:#998;font-style:italic">! C
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.1666666666</span>    <span style="color:#099">0.1666666666</span>    <span style="color:#099">0.0000000000</span>
    <span style="color:#099">0.0000000000</span>    <span style="color:#099">0.5000000000</span>    <span style="color:#099">0.0000000000</span>
    <span style="color:#099">0.5000000000</span>    <span style="color:#099">0.5000000000</span>    <span style="color:#099">0.0000000000</span>
    <span style="color:#099">0.6666666666</span>    <span style="color:#099">0.1666666666</span>    <span style="color:#099">0.0000000000</span>
    <span style="color:#099">0.1666666666</span>    <span style="color:#099">0.6666666666</span>    <span style="color:#099">0.0000000000</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>第一个坑</strong>：文献中的晶格常数应该怎样对应 <code>POSCAR</code> 中的晶格参数？</p>
<p>这取决于我们取的基底。上文中我们以相邻两个元胞的 B 原子间模长最短的矢量为基矢，因此这个这个元胞的实际晶格常数应为 $a = |\vec{a}<em>i| \times a</em>{POSCAR}$ ， $a$ 即为文中给出的晶格常数，可见，<code>POSCAR</code> 中的晶格参数可以理解为缩放系数，所以写完结构时应与文献对照或放入 VESTA 等软件测出原子键长看与文献是否一致。有的文献作者基底的取法特殊，所给的晶格常数也很“魔性”，但不变的是格子的实际大小、原子间距离等，以这些信息为准才能写出与文献中真正等价的结构。此外，二维结构的实现时需要层间有 20 A 左右的真空层，以避免层间不必要的相互作用，但真空层不可取太厚，否则计算量的增加不仅仅是线性的。</p>
<p><strong>闲话</strong>：如何建系是个见仁见智的问题，有人喜欢直接沿着六边形的边建系，有人喜欢像上文那样建系，但不管怎样，只要实现的结构是等价的那么建系就是没有问题的</p>
<h2 id="测出必要的参数">测出必要的参数</h2>
<h3 id="incar-template"><code>INCAR</code> Template</h3>
<p>在测各项参数之前，先给出一个<code>INCAR</code> 模板，具体参数的含义见注释或<code>VASP</code>手册。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">C3B Mono Layer  strcut_optim
  <span style="color:#0086b3">SYSTEM</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;C3B Mono Layer&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">系统注释</span>

Electronic minimization
  ISMEAR <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">使用</span>Gaussian smearing<span style="color:#a61717;background-color:#e3d2d2">，取</span> <span style="color:#099">0</span> <span style="color:#a61717;background-color:#e3d2d2">用于导体、绝缘体的计算</span>
  SIGMA <span style="color:#000;font-weight:bold">=</span>                   <span style="color:#a61717;background-color:#e3d2d2">#</span> Smearring <span style="color:#a61717;background-color:#e3d2d2">的宽度，在精度允许范围内应尽量大以减小计算量</span>
  EDIFF <span style="color:#000;font-weight:bold">=</span>                   <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">收敛判据的能量判据</span>
  EDIFFG <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">收敛判据，若值为负，则为力判据；若值为正，则为能量判据</span>
  PREC <span style="color:#000;font-weight:bold">=</span>                    <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">精确度</span>
  IBRION <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">离子移动方法，跑</span>MD<span style="color:#a61717;background-color:#e3d2d2">、弛豫抑或静态计算时设置不同</span>
  ISIF <span style="color:#000;font-weight:bold">=</span>                    <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">结构优化类型</span>

Ionic minimization
  NSW <span style="color:#000;font-weight:bold">=</span>                     <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">离子步数上限</span>
  NELMIN <span style="color:#000;font-weight:bold">=</span>                     <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">电子步收敛下限</span>
  ENCUT <span style="color:#000;font-weight:bold">=</span>                   <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">截断能，在保证收敛良好的情况下应尽量小</span>
  LWAVE <span style="color:#000;font-weight:bold">=</span>                   <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">是否输出</span> WAVECAR<span style="color:#a61717;background-color:#e3d2d2">；该值为</span> .FALSE. <span style="color:#a61717;background-color:#e3d2d2">时也会有</span> WAVECAR <span style="color:#a61717;background-color:#e3d2d2">输出，但其长度为</span> <span style="color:#099">0</span>
  LCHARG <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">是否输出</span> CHGCAR

Band Calcs
  ISTART <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">是否从当前目录读取</span> WAVECAR
  ICHARG <span style="color:#000;font-weight:bold">=</span>                  <span style="color:#a61717;background-color:#e3d2d2">#</span>  <span style="color:#099">1</span>: <span style="color:#a61717;background-color:#e3d2d2">读取</span> CHGCAR
                            <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#099">10</span>: <span style="color:#a61717;background-color:#e3d2d2">不改变当前目录下的</span> CHGCAR
</code></pre></td></tr></table>
</div>
</div><p>同时 <code>POTCAR</code> 这样获得：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat path/to/PPs/B/POTCAR &gt;&gt; ./POTCAR
cat path/to/PPs/C/POTCAR &gt;&gt; ./POTCAR
</code></pre></td></tr></table>
</div>
</div><p>这里注意 <code>POTCAR</code> 中元素赝势的顺序应与 <code>POSCAR</code> 元素出现的顺序一致。</p>
<h3 id="测出-sigma">测出 <code>SIGMA</code></h3>
<p>固定<code>ENCUT</code>和kpts为较大的值<code>ENCUT = 600</code>、<code>kpts = 21</code>，固定晶格常数为“合适”值，取一系列<code>SIGMA</code>值做静态计算，当<code>OSZICAR</code>中<code>dE</code>绝对值小于 1.0 meV/atom 时取最大的 <code>SIGMA</code> 值。</p>
<p>使用脚本如下（参考候柱锋老师的入门指南）：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>rm WAVECAR          <span style="color:#998;font-style:italic"># 删除目录中的 WAVECAR 以免影响收敛</span>
<span style="color:#998;font-style:italic"># in 后面 0.20 0.10 0.05 即为 sigma 所取的值，一般从大到小取，取值越小计算量越大当发现 dE 满足要求后可以及时终止计算</span>
<span style="color:#000;font-weight:bold">for</span> i in 0.20 0.10 0.05    
<span style="color:#000;font-weight:bold">do</span>
    cat &gt; INCAR &lt;&lt;! <span style="color:#998;font-style:italic"># 在 INCAR 中覆盖以下内容, ! 表示cat内容终止标志，可以自定义，如用 EOF</span>
<span style="color:#008080">SYSTEM</span> <span style="color:#000;font-weight:bold">=</span> Na adsorbed on site <span style="color:#099">1</span>
<span style="color:#008080">ENCUT</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">600</span>         <span style="color:#998;font-style:italic"># 截断能取较大值</span>
<span style="color:#008080">ISMEAR</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>          <span style="color:#998;font-style:italic"># Gaussian Smearing</span>
<span style="color:#008080">SIGMA</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#008080">$i</span>          <span style="color:#998;font-style:italic"># 每次循环 SIGMA 取 $i 的值</span>
<span style="color:#008080">NSW</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>             <span style="color:#998;font-style:italic"># 静态计算，离子步数为 1</span>
<span style="color:#008080">IBRION</span> <span style="color:#000;font-weight:bold">=</span> -1            <span style="color:#998;font-style:italic"># 静态计算</span>
<span style="color:#008080">LWAVE</span> <span style="color:#000;font-weight:bold">=</span> .FALSE.     <span style="color:#998;font-style:italic"># 不输出 WAVECAR，不使用上次计算所得平面波系数作为初始值</span>
!
    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34; SIGMA = </span><span style="color:#008080">$i</span><span style="color:#d14"> eV &#34;</span>
    <span style="color:#0086b3">time</span> vasp &gt;&gt; vasp.log   <span style="color:#998;font-style:italic"># 执行 vasp 计算，重定向输出到 vasp.log ，并对该过程计时，结果输出到 stdout</span>
    <span style="color:#998;font-style:italic"># OUTCAR 中 EENTRO 等于 OSZICAR 中的 dE，这里取出 dE</span>
    <span style="color:#008080">TS</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;EENTRO&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%12.6f&#34;, $5}&#39;</span><span style="color:#d14">`</span>
    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$i</span><span style="color:#d14">   </span><span style="color:#008080">$TS</span><span style="color:#d14">&#34;</span> &gt;&gt; sigma.txt     <span style="color:#998;font-style:italic"># 输出 SIGMA 和 dE 到sigma.txt</span>
    <span style="color:#0086b3">echo</span> -e <span style="color:#d14">&#34;\n\n&#34;</span>   <span style="color:#998;font-style:italic"># 换行 3 次</span>
<span style="color:#000;font-weight:bold">done</span>
</code></pre></td></tr></table>
</div>
</div><p>所得 sigma.txt 内容如下</p>
<pre><code>0.20   -0.00519083
0.10   -0.00009427
0.05   0.00000000
</code></pre><p>显然，这里<code>SIGMA</code>取 0.10 即可，当然还可以在 (0.10, 0.20) 之间再取几个点，逼近使 dE &lt; 1meV/atom 的最大 SIGMA。</p>
<h3 id="测出-encut">测出 <code>ENCUT</code></h3>
<p>将上面测出的 <code>SIGMA = 0.10</code> 固定，<code>ENCUT</code> 取不同值，过程与上面类似，只是判断 <code>ENCUT</code> 取值的依据变成了两次计算结果的<code>TOTEN</code>之差绝对值小于 1 meV/atom。</p>
<p>使用脚本如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
rm WAVECAR
<span style="color:#000;font-weight:bold">for</span> i in <span style="color:#099">300</span> <span style="color:#099">350</span> <span style="color:#099">400</span> <span style="color:#099">450</span> <span style="color:#099">500</span> <span style="color:#099">550</span> <span style="color:#099">600</span> <span style="color:#998;font-style:italic"># 每次循环 ENCUT 的取值</span>
<span style="color:#000;font-weight:bold">do</span>
    cat &gt; INCAR &lt;&lt;!
<span style="color:#008080">SYSTEM</span> <span style="color:#000;font-weight:bold">=</span> Na adsorbed on site <span style="color:#099">1</span>
<span style="color:#008080">ENCUT</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#008080">$i</span>
<span style="color:#008080">ISMEAR</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
<span style="color:#008080">SIGMA</span> <span style="color:#000;font-weight:bold">=</span> 0.10        <span style="color:#998;font-style:italic"># SIGMA 取上面测得的值</span>
<span style="color:#008080">NSW</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>
<span style="color:#008080">IBRION</span> <span style="color:#000;font-weight:bold">=</span> -1
!
    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34; ENCUT = </span><span style="color:#008080">$i</span><span style="color:#d14"> eV &#34;</span>
    <span style="color:#0086b3">time</span> vasp &gt;&gt; vasp.log
    <span style="color:#008080">E</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;TOTEN&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%12.6f&#34;, $5}&#39;</span><span style="color:#d14">`</span>    <span style="color:#998;font-style:italic"># 取出 OUTCAR 中的 TOTEN</span>
    <span style="color:#0086b3">echo</span> <span style="color:#d14">&#34;</span><span style="color:#008080">$i</span><span style="color:#d14">   </span><span style="color:#008080">$E</span><span style="color:#d14">&#34;</span> &gt;&gt; encut.txt
    <span style="color:#0086b3">echo</span> -e <span style="color:#d14">&#34;E = </span><span style="color:#008080">$E</span><span style="color:#d14">\n\n&#34;</span>
<span style="color:#000;font-weight:bold">done</span>
</code></pre></td></tr></table>
</div>
</div><p>测得 <code>ENCUT</code> 取值为 450。这里 <code>ENCUT</code> 如果取值过小，后面在弛豫时很可能能量不会收敛。</p>
<h3 id="测出-kpts">测出 kpts</h3>
<p>kpts 指的是 <code>KPOINTS</code> 里 meshgrid 的取样点数，取样越多，计算结果收敛越好，同时计算量也变大。取值条件与上面相同，即两次计算的 <code>TOTEN</code> 相差小于 1meV/atom 。</p>
<p><strong>注意，不要忘了把测好的 <code>SIGMA</code> 和 <code>ENCUT</code> 写入 <code>INCAR</code></strong></p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
rm WAVECAR
<span style="color:#000;font-weight:bold">for</span> i in <span style="color:#099">9</span> <span style="color:#099">13</span> <span style="color:#099">17</span> <span style="color:#099">21</span>    <span style="color:#998;font-style:italic"># kpts 取 9 13 17 21</span>
<span style="color:#000;font-weight:bold">do</span>
    cat &gt; KPOINTS &lt;&lt;!
Na adsorbed on site1 -- det_kp
<span style="color:#099">0</span>
Monkhorst-Pack        <span style="color:#998;font-style:italic"># 只要第一个字母为 M 即可</span>
    <span style="color:#008080">$i</span>  <span style="color:#008080">$i</span>  <span style="color:#099">1</span>        <span style="color:#998;font-style:italic"># 有真空层存在，z方向采样点数为 1</span>
    <span style="color:#099">0</span>   <span style="color:#099">0</span>   <span style="color:#099">0</span>
!
    <span style="color:#0086b3">echo</span> -e <span style="color:#d14">&#34;k mesh = </span><span style="color:#008080">$i</span><span style="color:#d14">\t</span><span style="color:#008080">$i</span><span style="color:#d14">\t1&#34;</span>; <span style="color:#0086b3">time</span> vasp &gt;&gt; vasp.log
    <span style="color:#008080">E</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;TOTEN&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%18.10f&#34;, $5}&#39;</span><span style="color:#d14">`</span>
    <span style="color:#008080">KP</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;irreducible&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%5i&#34;, $2}&#39;</span><span style="color:#d14">`</span>
    <span style="color:#0086b3">echo</span> <span style="color:#008080">$i</span> <span style="color:#008080">$KP</span> <span style="color:#008080">$E</span> &gt;&gt; det_kp.txt
<span style="color:#000;font-weight:bold">done</span>
</code></pre></td></tr></table>
</div>
</div><p>测得 kpts 取15。</p>
<p><strong>第二个坑</strong>：<code>KPOINTS</code> 文件名一定要写对，本渣使用的 <code>VASP</code> 版本为 5.3.5，计算中如果没检测到 <code>KPOINTS</code> 文件存在，则<strong>默认</strong> kpts 取值为 <strong>3</strong> ，导致结果错误。本渣某次计算中误将 <code>KPOINTS</code> 写成了 <code>KPOINS</code> ，导致后面无论如何修改参数，结果与文献值始终相差很大。（这个东西不仅坑了我，还坑了<strong>比那名居腿娘</strong>(来自WHU的EE大佬)大神熬夜到 3 点多，说来惭愧……</p>
<h3 id="测出-a">测出 <code>a</code></h3>
<p>这里的<code>a</code>确切地指 <code>POSCAR</code> 中第二行的那个数值，即元胞的放大系数。因为本例中的晶格基矢模长 $|\vec{a_1}| = |\vec{a_2}| = 1$ ，故其放大系等于文献中的晶格常数 $a$。这里 <code>a</code> 的取值条件与上面相同。给出测试脚本如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
rm WAVECAR
<span style="color:#998;font-style:italic"># 晶格参数的取值应在文献值附近取点</span>
<span style="color:#000;font-weight:bold">for</span> i in 4.97 5.02 5.07 5.12 5.17 5.22 5.27 5.32 5.37
<span style="color:#000;font-weight:bold">do</span>
    cat &gt; POSCAR &lt;&lt;!
C3B graphene like structure, <span style="color:#008080">a</span> <span style="color:#000;font-weight:bold">=</span> 5.17
   <span style="color:#008080">$i</span>
    0.8660254037   -0.5000000000    0.0000000000
    0.8660254037    0.5000000000    0.0000000000
    0.0000000000    0.0000000000    3.0000000000
   B    C
   <span style="color:#099">2</span>    <span style="color:#099">6</span>
Direct
    0.0000000000    0.0000000000    0.0000000000    ! B1
    0.6666666666    0.6666666666    0.0000000000    ! B2
    0.5000000000    0.0000000000    0.0000000000    ! C1
    0.1666666666    0.1666666666    0.0000000000    ! C2
    0.0000000000    0.5000000000    0.0000000000    ! C3
    0.5000000000    0.5000000000    0.0000000000    ! C4
    0.6666666666    0.1666666666    0.0000000000    ! C5
    0.1666666666    0.6666666666    0.0000000000    ! C6
!
    <span style="color:#0086b3">echo</span> -e <span style="color:#d14">&#34;a = </span><span style="color:#008080">$i</span><span style="color:#d14"> angstrom&#34;</span>; <span style="color:#0086b3">time</span> vasp &gt;&gt; vasp.log
    <span style="color:#008080">E</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;TOTEN&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%12.6f&#34;, $5 }&#39;</span><span style="color:#d14">`</span>
    <span style="color:#008080">V</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">`</span>grep <span style="color:#d14">&#34;volume&#34;</span> OUTCAR | tail -1 | awk <span style="color:#d14">&#39;{printf &#34;%12.4f&#34;, $5}&#39;</span><span style="color:#d14">`</span>
    <span style="color:#0086b3">printf</span> <span style="color:#d14">&#34;%6.3f %10.4f %18.10f\n&#34;</span> <span style="color:#008080">$i</span> <span style="color:#008080">$V</span> <span style="color:#008080">$E</span> &gt;&gt; a.txt
    tail -1 a.txt
<span style="color:#000;font-weight:bold">done</span>
</code></pre></td></tr></table>
</div>
</div><p>测得 <code>a</code> 与文献值相同，5.17。这里的 <code>a</code> 还可以取得更精细一些，甚至可以到小数点后三位，这里取值越接近“真实值”，后面弛豫的过程将会越短。</p>
<h2 id="弛豫结构优化relaxation">弛豫（结构优化，relaxation）</h2>
<p>弛豫中需要用到的 <code>INCAR</code> 参数有</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">ISMEAR <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>       <span style="color:#998;font-style:italic">! 继承自上面的计算结果
</span><span style="color:#998;font-style:italic"></span>SIGMA <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>
ENCUT <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">450</span>

PREC <span style="color:#000;font-weight:bold">=</span> Accurate
EDIFF <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.0E-6</span>
EDIFFG <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">0.01</span>
IBRION <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>       <span style="color:#998;font-style:italic">! 准牛顿法
</span><span style="color:#998;font-style:italic"></span>ISIF <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">3</span>         <span style="color:#998;font-style:italic">! 计算 force、stress tensor，对离子、晶格进行弛豫 
</span><span style="color:#998;font-style:italic"></span>
NELMIN <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">6</span>       <span style="color:#998;font-style:italic">! (optional) 强制每个离子步跑至少 6 电子步，提高收敛效果
</span><span style="color:#998;font-style:italic"></span>NSW <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">200</span>        <span style="color:#998;font-style:italic">! 离子步上限为 200 步，目前本渣所算的体系中离子步数没有超过这个值的，也许是我太年轻了吧
</span></code></pre></td></tr></table>
</div>
</div><p>这个步骤耗时最长，尤其是加上 <code>PREC</code> 后，每个电子步计算量上升很多，而为了结构的优化，离子步数的增多也使这个过程耗时不少，本例中 8 个原子的体系优化需要数个小时；本渣另外的一个体系中有 12 个原子，优化就需要 12h+ 。</p>
<p><strong>第三个坑</strong>：<code>EDIFFG</code>有正负之分，<strong>负数</strong>表示收敛的力判据。如果<code>EDIFFG</code>误写为正，则<code>EDIFF</code>会被覆盖，<code>VASP</code>按照<code>EDIFFG</code>进行收敛判断，结果就是收敛可能会变得很快（快上几个数量级），但是所得结构不是我们想要的结构。</p>
<p><strong>第四个坑</strong>：如果 <code>EDIFF</code>和<code>EDIFFG</code>设置过小，则计算时收敛可能会变得非常漫长，有时甚至会将结构跑散——原子间距离越来越大，这时候有三种选择：1. 提高精度，重新测出晶格常数，晶格常数可以精确到 0.001；2. 放宽收敛判据； 3. <code>IBRION</code> 取 2 （如果你对这个结构是否稳定没有信心的话。</p>
<h2 id="高精度的电子自洽计算scf">高精度的电子自洽计算（SCF）</h2>
<p>进行高精度的电子自洽计算是为了得到体系的电荷分布，同时也为后面计算能带提供数据。</p>
<p>这一步需要<strong>将 relaxation 得到的 CONTCAR 复制到 SCF 计算目录下，并重命名为 POSCAR</strong> ，<code>INCAR</code> 内容相似，仅将弛豫相关参数修改即可，<code>INCAR</code> 如下</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">C3B Mono Layer  strcut_optim
  <span style="color:#0086b3">SYSTEM</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;C3B Mono Layer&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#0086b3">System </span>Name

Electronic minimization
  ISMEAR <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>                <span style="color:#a61717;background-color:#e3d2d2">#</span> Toggle Gaussian Method, complete later
  SIGMA <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.1</span>               <span style="color:#a61717;background-color:#e3d2d2">#</span> Broadening in eV <span style="color:#000;font-weight:bold">-</span><span style="color:#099">4</span><span style="color:#000;font-weight:bold">-</span>tet<span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">-</span>fermi <span style="color:#099">0</span><span style="color:#000;font-weight:bold">-</span>gaus
  EDIFF <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.E-6</span>             <span style="color:#a61717;background-color:#e3d2d2">#</span> Energy tolerance eV<span style="color:#000;font-weight:bold">/</span>atom
<span style="color:#999;font-weight:bold;font-style:italic">#  EDIFFG = -0.01            # Force tolerance
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>  PREC <span style="color:#000;font-weight:bold">=</span> Accurate           <span style="color:#a61717;background-color:#e3d2d2">#</span> Accuracy
  IBRION <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>               <span style="color:#a61717;background-color:#e3d2d2">#</span> quasi<span style="color:#000;font-weight:bold">-</span>Newton algorithm
<span style="color:#999;font-weight:bold;font-style:italic">#  ISIF = 3                  # optim totally: volume, stress, force, ion, shape
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
Ionic minimization
  NSW <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>                   <span style="color:#a61717;background-color:#e3d2d2">#</span> Converge steps, must set
  ENCUT <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">450</span>               <span style="color:#a61717;background-color:#e3d2d2">#</span> components beyond ENCUT are <span style="color:#d14">&#39;removed&#39;</span> from the projection
                            <span style="color:#a61717;background-color:#e3d2d2">#</span> operators
  LWAVE <span style="color:#000;font-weight:bold">=</span> .TRUE.            <span style="color:#a61717;background-color:#e3d2d2">#</span> Output WAVECAR
  LCHARG <span style="color:#000;font-weight:bold">=</span> .TRUE.           <span style="color:#a61717;background-color:#e3d2d2">#</span> Output density of charge to CHG <span style="color:#0086b3">and </span>CHGCAR
  NCORE <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">4</span>
</code></pre></td></tr></table>
</div>
</div><p>由于默认输出 <code>CHGCAR</code> ， <code>INCAR</code> 中的 <code>LCHARG</code> 可以不写。</p>
<h2 id="计算能带band">计算能带（band）</h2>
<p><strong>复制 SCF 计算所得 CHGCAR 到 band 计算目录下。</strong></p>
<p>我们需要重写 <code>KPOINTS</code> ，之前的 <code>KPOINTS</code> 一直是系统帮助我们在布里渊区采样，现在我们想要得到布里渊区某一路径上能带的能量变化，则需要在 <code>KPOINTS</code> 指定出路径。</p>
<p>根据 <a href="https://arxiv.org/abs/1004.2974">DOI:10.1016/j.commatsci.2010.05.010</a> 后面所给资料提示选择对应的布里渊区 K 点路径（注意文中基矢的取法是否与自己一致，否则需要重新画出布里渊区，找出对应的 K 点。这里在寻找 K 点时可以借助 <a href="http://www.xcrysden.org/">XCrysDen</a> ，选择 K-Point path 即可</p>
<p><img src="http://owucpthrj.bkt.clouddn.com/FpmnmrDYGQOgi2NLIPUvy31t0c4p" alt="这里取 Gamma -> K -> M -> Gamma"></p>
<p>写出 <code>KPOINTS</code> 如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran" data-lang="fortran">K<span style="color:#000;font-weight:bold">-</span>POINTS    C3B Mono Layer Bands    <span style="color:#998;font-style:italic">! 注释行
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">40</span>                              <span style="color:#998;font-style:italic">! 每两个K点之间取样点数
</span><span style="color:#998;font-style:italic"></span>Line<span style="color:#000;font-weight:bold">-</span>mode                           <span style="color:#998;font-style:italic">! Line-mode，区别于自动取样模式，跑能带专用
</span><span style="color:#998;font-style:italic"></span>Rec                                 <span style="color:#998;font-style:italic">! 在倒空间内取点
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0</span>       <span style="color:#099">0</span>       <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! Gamma
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.33333</span> <span style="color:#099">0.66666</span> <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! K
</span><span style="color:#998;font-style:italic"></span>
    <span style="color:#099">0.33333</span> <span style="color:#099">0.66666</span> <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! K
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0.5</span>     <span style="color:#099">0.5</span>     <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! M
</span><span style="color:#998;font-style:italic"></span>
    <span style="color:#099">0.5</span>     <span style="color:#099">0.5</span>     <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! M
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#099">0</span>       <span style="color:#099">0</span>       <span style="color:#099">0</span>               <span style="color:#998;font-style:italic">! Gamma
</span></code></pre></td></tr></table>
</div>
</div><p>同时在 <code>INCAR</code> 中加上 <code>ICHARG = 11</code> 以读取 SCF 所得 <code>CHGCAR</code> 进行能带计算。</p>
<p>最后，取所得 <code>vasprun.xml</code> 导入 <code>p4vasp</code> 进行绘制能带图。如果读者有兴趣可以以 <code>EIGENVAL</code>  文件为输入自己实现绘制band的程序（不会很难）。</p>
<blockquote>
<p>跑能带的感觉就和抽卡/开箱是一样的，你永远也不知道下一个体系的 band 会是什么鸟样。</p>
</blockquote>
<p>跑出的能带是这个样子</p>
<p><img src="http://owucpthrj.bkt.clouddn.com/Fodl8Omy6tyxekWIF6pAxHI_lPkN" alt=""></p>
<p>文献中的截图是这个样子的</p>
<p><img src="http://owucpthrj.bkt.clouddn.com/Fp0bJ1vUyw-dm2uxoVXt61hm6ka_" alt=""></p>
<p>这里解释一下，本渣最初在跑 band 时 K 点取的路径和文献不同，所以两幅图基本等于对方水平翻转所得，但本文中所给 <code>KPOINTS</code> 里 K 点路径与文献是相符的。细心的大神已经看出两幅图中上图似乎向下平移了一部分，这可能是费米能级的取值差异所致，由于本渣水平太低，姑且只能这样理解了。</p>
<h2 id="计算态密度dos">计算态密度（DOS）</h2>
<p>如果阅读过文献的话，我们会发现文献中经常和能带图一起出现的还有 <em>态密度</em> 图。何为态密度？<a href="https://zh.wikipedia.org/zh-hans/%E7%8A%B6%E6%80%81%E5%AF%86%E5%BA%A6">Wikipedia</a> 上的解释为某一能量周围单位区间内的微观状态数量。具体到本文，上面的微观状态便是指占据某能级的电子态。</p>
<h1 id="论检查输入文件正确性的重要性">论检查输入文件正确性的重要性</h1>
<p>这里的输入文件指 <code>VASP</code> 计算时需要用到的文件，如<code>INCAR</code>、<code>POSCAR</code>、<code>POTCAR</code>、<code>KPOINTS</code>、<code>CHGCAR</code>等。</p>
<ol>
<li>文件名是否正确。我知道很多人在 <code>bash</code> 中喜欢用 Tab 补全，这对提高命令输入效率非常有效，但同时也降低了我们检查文件名正确性的机会，上文中提到的 <code>KPOINS</code> 错误就是因为一直使用 Tab 补全而使它一直被继承到跑出 band ，还不止坑了自己，多么可笑；</li>
<li>脚本中重定向输出的文件名是否与需求一致。当使用上一次计算的脚本进行修改时本渣很容易忘了修改输出重定向的目标，从而导致 <code>POSCAR</code> 的内容被输出到 <code>KPOINTS</code> 里，这时 <code>VASP</code> 会报错，遇到这种情况及时修改脚本重新提交任务即可，无非是重新排队的问题；</li>
<li><code>POTCAR</code> 是否与体系相对应。有的论文并不明确说出自己使用哪个 <code>POTCAR</code> ，而是这样说：&ldquo;We treated 4p, 5s, 4d orbitals of xx, and x orbitals of xxx as valence electrons…&quot;，这就表明我们需要考虑使用带 <code>_pv</code> 、 <code>_sv</code> 的 <code>POTCAR</code> 。<strong>这大概是本人近期踩过的最大的坑了吧</strong>，可以想象，如果从一开始的 <code>POTCAR</code> 就出了问题，那么后面所有的计算就都是徒劳的，而在排错时无论如何也很难将目光投向 <code>POTCAR</code> 。这里要特别感谢 <strong>比那名居腿娘</strong> 同学的帮助；</li>
<li><code>POSCAR</code> 中的晶胞是否需要超胞。有的文献中给出一个 band 图但未给出其对应的结构，本渣按照前文所给结构计算，始终无法得到与文献相符的 band 图，直到本渣使用 2x2 超胞后的结构进行计算，终于重复出和文献很接近的结果；</li>
<li>有时在弛豫后进行 SCF 计算时会提示对称性错误，这时需要在 <code>INCAR</code> 中指定 <code>SYMPREC</code> 的值，这个值默认为<code>SYMPREC = 1.0E-5</code>，指定时可以使用更小的值。</li>
</ol>
<p>除了上面说到的 <code>INCAR</code>、<code>POSCAR</code>、<code>POTCAR</code>、<code>KPOINTS</code>、<code>CHGCAR</code>等，有时还会用到 <code>WAVECAR</code> ，<code>WAVECAR</code> 是二进制文件，在使用 FileZilla 传送时，如果没有勾选 <code>binary</code> 选项，则传送时会按照 ASCII 编码进行传送，后果就是 <code>WAVECAR</code> 文件损坏。</p>
<h1 id="参考资料">参考资料</h1>
<ol>
<li>VASP软件包的使用入门指南——候柱锋</li>
<li>VASP the GUIDE(April 20, 2016)——Kresse, Martijn Marsman , Jurgen Furthmuller</li>
<li><a href="https://arxiv.org/abs/1004.2974">High-throughput electronic band structure calculations: challenges and tools</a> ——<a href="https://arxiv.org/find/cond-mat/1/au:+Setyawan_W/0/1/0/all/0/1">Wahyu Setyawan</a>, <a href="https://arxiv.org/find/cond-mat/1/au:+Curtarolo_S/0/1/0/all/0/1">Stefano Curtarolo</a></li>
</ol>
<p>这次 blog 就写到这里吧，反正也是为自己写的。（当然如果有大佬愿意在评论区指出其中的错误，本渣感激不尽！</p>
<p>最后祝愿各位读到这里的菊苣，提前（</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://ionizing.page/">Ionizing</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://ionizing.page/post/how-to-struggle-with-vasp/">https://ionizing.page/post/how-to-struggle-with-vasp/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/how-to-solve-viberation-1/">简谐振动系统浅析（一）</a></li>
        
        <li><a href="/post/Coriolis-Force/">浅谈科里奥利力</a></li>
        
        <li><a href="/post/Quantum-Physics-Learning-Log-1/">量子力学学习手记（一）</a></li>
        
        <li><a href="/post/PhysChem-Revise-1/">物理化学复习札记（一）：理想气体热力学量求解总结</a></li>
        
        <li><a href="/post/PAT%E9%A2%98%E8%A7%A3-B-1035/">PAT题解 B 1035</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://ionizing.page/tags/VASP'>VASP</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Ionizing/ionizing.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://ionizing.page/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://ionizing.page/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://ionizing.page/post/nbody-with-cuda/" title="使用 CUDA 为 N 体模拟加速">使用 CUDA 为 N 体模拟加速</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/compile-vasp-on-macos/" title="在 macOS 上编译 VASP 5.4.4">在 macOS 上编译 VASP 5.4.4</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/2019-3-22-Ensembles/" title="统计力学笔记——系综的概念">统计力学笔记——系综的概念</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/how-to-solve-matrix-B-in-A-times-B-equals-C/" title="如何求解 A * B = C 中的矩阵 B ？">如何求解 A * B = C 中的矩阵 B ？</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/2019-1-21-how-to-setup-travis-ci/" title="如何为 github 上的 cpp 项目设置 Travis-CI 自动测试">如何为 github 上的 cpp 项目设置 Travis-CI 自动测试</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/2018-12-31_WAVECAR-parsing/" title="WAVECAR 数据结构的解析">WAVECAR 数据结构的解析</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/how-to-struggle-with-vasp/" title="在 VASP(PBE) 计算中如何优雅地踩坑？">在 VASP(PBE) 计算中如何优雅地踩坑？</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/how-to-solve-viberation-1/" title="简谐振动系统浅析（一）">简谐振动系统浅析（一）</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/Coriolis-Force/" title="浅谈科里奥利力">浅谈科里奥利力</a>
    </li>
    
    <li>
        <a href="https://ionizing.page/post/Quantum-Physics-Learning-Log-1/" title="量子力学学习手记（一）">量子力学学习手记（一）</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="https://ionizing.page/categories/Algorithm/">Algorithm (1)</a></li>
    
    <li><a href="https://ionizing.page/categories/AtomicPhysics/">AtomicPhysics (2)</a></li>
    
    <li><a href="https://ionizing.page/categories/FirstPrinciple/">FirstPrinciple (2)</a></li>
    
    <li><a href="https://ionizing.page/categories/PhysicalChemistry/">PhysicalChemistry (2)</a></li>
    
    <li><a href="https://ionizing.page/categories/Physics/">Physics (3)</a></li>
    
    <li><a href="https://ionizing.page/categories/Programming/">Programming (2)</a></li>
    
    <li><a href="https://ionizing.page/categories/QuantumMechanics/">QuantumMechanics (1)</a></li>
    
    <li><a href="https://ionizing.page/categories/VASP/">VASP (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://ionizing.page/tags/Angular-Momentum-Coupling/">Angular Momentum Coupling</a>
    
    <a href="https://ionizing.page/tags/Bohr/">Bohr</a>
    
    <a href="https://ionizing.page/tags/C&#43;&#43;/">C&#43;&#43;</a>
    
    <a href="https://ionizing.page/tags/CUDA/">CUDA</a>
    
    <a href="https://ionizing.page/tags/Clebsch-Gordan-Coefficients/">Clebsch-Gordan Coefficients</a>
    
    <a href="https://ionizing.page/tags/Correspondence-Principle/">Correspondence Principle</a>
    
    <a href="https://ionizing.page/tags/Hydrogen-Atom-Model/">Hydrogen Atom Model</a>
    
    <a href="https://ionizing.page/tags/Hydrogen-Spectra/">Hydrogen Spectra</a>
    
    <a href="https://ionizing.page/tags/Linear-Algebra/">Linear Algebra</a>
    
    <a href="https://ionizing.page/tags/NBody/">NBody</a>
    
    <a href="https://ionizing.page/tags/Negative-Temperature/">Negative Temperature</a>
    
    <a href="https://ionizing.page/tags/OUTCAR/">OUTCAR</a>
    
    <a href="https://ionizing.page/tags/PAT/">PAT</a>
    
    <a href="https://ionizing.page/tags/Physical-Chemistry/">Physical Chemistry</a>
    
    <a href="https://ionizing.page/tags/Rydberg-Constant/">Rydberg Constant</a>
    
    <a href="https://ionizing.page/tags/Statistical-Mechanics/">Statistical Mechanics</a>
    
    <a href="https://ionizing.page/tags/VASP/">VASP</a>
    
    <a href="https://ionizing.page/tags/WAVECAR/">WAVECAR</a>
    
    <a href="https://ionizing.page/tags/Wigner-3-j-Symbol/">Wigner 3-j Symbol</a>
    
    <a href="https://ionizing.page/tags/cpp/">cpp</a>
    
    <a href="https://ionizing.page/tags/macOS/">macOS</a>
    
    <a href="https://ionizing.page/tags/travis-ci/">travis-ci</a>
    
    <a href="https://ionizing.page/tags/%E5%8C%96%E5%AD%A6/">化学</a>
    
    <a href="https://ionizing.page/tags/%E6%8C%AF%E5%8A%A8/">振动</a>
    
    <a href="https://ionizing.page/tags/%E6%8E%92%E5%BA%8F/">排序</a>
    
    <a href="https://ionizing.page/tags/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/">数学基础</a>
    
    <a href="https://ionizing.page/tags/%E7%89%A9%E7%90%86/">物理</a>
    
    <a href="https://ionizing.page/tags/%E7%89%A9%E7%90%86%E5%8C%96%E5%AD%A6/">物理化学</a>
    
    <a href="https://ionizing.page/tags/%E7%89%A9%E7%90%86%E5%AD%A6/">物理学</a>
    
    <a href="https://ionizing.page/tags/%E7%A7%91%E9%87%8C%E5%A5%A5%E5%88%A9%E5%8A%9B/">科里奥利力</a>
    
    <a href="https://ionizing.page/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/">线性代数</a>
    
    <a href="https://ionizing.page/tags/%E7%BB%8F%E5%85%B8%E5%8A%9B%E5%AD%A6/">经典力学</a>
    
    <a href="https://ionizing.page/tags/%E9%87%8F%E5%AD%90%E5%8A%9B%E5%AD%A6/">量子力学</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://ionizing.page/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="https://ionizing.page/">伪化生搬砖工地 By Ionizing</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.2.8/raphael.min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/flowchart/1.12.2/flowchart.min.js" crossorigin="anonymous"></script>
        <script>(function () {
                if (!window.flowchart) return;
                const blocks = document.querySelectorAll('pre code.language-flowchart, pre code.language-flow');
                for (let i = 0; i < blocks.length; i++) {
                    const block = blocks[i];
                    const rootElement = block.parentNode;
                    const container = document.createElement('div');
                    const id = `js-flowchart-diagrams-${i}`;
                    container.id = id;
                    container.className = 'align-center';
                    container.setAttribute("style", "overFlow-x:auto");
                    rootElement.parentNode.replaceChild(container, rootElement);
                    const diagram = flowchart.parse(block.childNodes[0].nodeValue);
                    diagram.drawSVG(id, window.flowchartDiagramsOptions ? window.flowchartDiagramsOptions : {});
                }
            })();
        </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js" crossorigin="anonymous"></script>
        <script>window.sequenceDiagramsOptions = {theme: 'simple'};(function () {
            if (!window.Diagram) return;
            const blocks = document.querySelectorAll('pre code.language-sequence');
            for (let i = 0; i < blocks.length; i++) {
                const block = blocks[i];
                
                const rootElement = block.parentNode;
                const container = document.createElement('div');
                const id = `js-sequence-diag-${i}`;
                container.id = id;
                container.className = 'align-center';
                container.setAttribute("style", "overFlow-x:auto");
                rootElement.parentNode.replaceChild(container, rootElement);

                const diagram = Diagram.parse(block.childNodes[0].nodeValue);
                diagram.drawSVG(id, window.sequenceDiagramsOptions
                    ? window.sequenceDiagramsOptions
                    : { theme: 'simple' });
            }
        })();
        </script><script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-101595379-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>